<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é›è‹±æ–‡å†’éšª - 3D ä½ˆå±€å„ªåŒ–ç‰ˆ</title>
    <!-- å¼•å…¥ Three.js èˆ‡ GLTF è¼‰å…¥å™¨ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        :root {
            --scene-bg: #e8f5e9;
            --scene-accent: #81c784;
            --text-color: #333;
            --gold: #ffd700;
        }

        /* å°æ‡‰èƒŒæ™¯åœ–æª”æ¡ˆ */
        body.easy { --scene-bg: #e8f5e9; --scene-accent: #2e7d32; background-image: url('bg_easy.jpg'); }
        body.medium { --scene-bg: #fff3e0; --scene-accent: #e65100; background-image: url('bg_medium.jpg'); }
        body.hard { --scene-bg: #37474f; --scene-accent: #ff5252; --text-color: #fff; background-image: url('bg_hard.jpg'); }

        * { box-sizing: border-box; transition: background-color 0.8s ease; }

        body {
            background-color: var(--scene-bg);
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            min-height: 100vh; margin: 0; color: var(--text-color); overflow: hidden; position: relative;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-blend-mode: soft-light;
            padding-top: 60px; /* ç‚ºå›ºå®šæ¨™é¡Œé¨°å‡ºç©ºé–“ */
        }

        #top-info {
            position: fixed; top: 10px; width: 95%; max-width: 500px;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(8px);
            padding: 8px 20px; border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15); z-index: 10; color: #333;
        }

        /* ç¸®å° 3D ç•«å¸ƒå®¹å™¨ä»¥ç¯€çœç©ºé–“ */
        #canvas-container {
            width: 220px; height: 220px;
            margin-bottom: 2px; z-index: 5;
            position: relative;
            flex-shrink: 0; /* é˜²æ­¢è¢«å£“ç¸® */
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.2));
        }

        /* ç·Šæ¹ŠåŒ–å°è©±æ¡† */
        #chick-speech { 
            margin-top: 0px; padding: 8px 15px; 
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(4px);
            border-radius: 12px; 
            font-weight: bold; box-shadow: 0 3px 8px rgba(0,0,0,0.1); 
            position: relative; color: #333; max-width: 320px; 
            text-align: center; font-size: 14px; min-height: 45px;
            display: flex; align-items: center; justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.5);
            z-index: 6;
        }

        /* å„ªåŒ–éŠæˆ²ç›’ä½ˆå±€ */
        #game-box {
            background: rgba(255, 255, 255, 0.92); 
            backdrop-filter: blur(12px);
            padding: 15px; border-radius: 20px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            text-align: center; width: 95%; max-width: 500px; 
            z-index: 5; color: #333; margin-top: 10px;
            max-height: 45vh; /* é™åˆ¶é«˜åº¦ï¼Œé¿å…è¶…å‡ºè¢å¹• */
            overflow-y: auto; /* å…§å®¹éå¤šæ™‚å¯æ»¾å‹• */
        }

        .stage-badge { display: inline-block; padding: 2px 10px; border-radius: 20px; background: #eee; font-size: 11px; margin-bottom: 5px; font-weight: 800; color: var(--scene-accent); }
        .question { font-size: 16px; margin-bottom: 10px; line-height: 1.4; font-weight: 600; text-align: left; }
        .en-q { color: #555; font-style: italic; font-size: 14px; display: block; margin-top: 2px; border-left: 3px solid var(--scene-accent); padding-left: 10px; }

        .options-grid { display: grid; grid-template-columns: 1fr; gap: 6px; }

        button {
            padding: 10px 15px; border: 1px solid #ddd; background: #fff; border-radius: 10px;
            cursor: pointer; font-size: 16px; font-weight: bold; color: #444; transition: all 0.2s;
        }
        button:hover:not(:disabled) { border-color: var(--scene-accent); background: #fdfdfd; transform: scale(1.01); }
        button.correct { background: #81c784 !important; color: white; border-color: #81c784; }
        button.wrong { background: #e57373 !important; color: white; border-color: #e57373; }

        /* è£å‚™é¡¯ç¤ºç¸®æ”¾ */
        #equipment-slots {
            position: absolute; width: 100%; height: 100%;
            top: 0; left: 0; pointer-events: none;
        }
        .eq-item { 
            position: absolute; font-size: 30px; opacity: 0; 
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            transform: scale(0); filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
        }
        .eq-item.active { opacity: 1; transform: scale(1); }
        
        .eq-0 { top: 5%; left: 0%; }    .eq-1 { top: -5%; left: 40%; }  .eq-2 { top: 5%; right: 0%; }
        .eq-3 { top: 40%; left: -10%; } .eq-4 { top: 40%; right: -10%; } .eq-5 { bottom: 15%; left: -5%; }
        .eq-6 { bottom: 0%; left: 40%; } .eq-7 { bottom: 15%; right: -5%; }
        .eq-8 { top: 20%; left: 10%; }   .eq-9 { top: 20%; right: 10%; }

        #ceremony {
            position: fixed; inset: 0; background: rgba(0,0,0,0.96);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            color: white; z-index: 100; text-align: center;
        }
        #progress-bar { position: fixed; bottom: 0; left: 0; height: 6px; background: var(--scene-accent); width: 0%; transition: width 0.5s; }
    </style>
</head>
<body class="easy">

    <div id="top-info">
        <span id="scene-name">ğŸŒ² Easy: Vocabulary</span>
        <span>Score: <strong id="score-val">0</strong></span>
    </div>

    <div id="canvas-container">
        <div id="equipment-slots">
            <div class="eq-item eq-0">ğŸ§­</div><div class="eq-item eq-1">ğŸ’</div><div class="eq-item eq-2">ğŸ¼</div>
            <div class="eq-item eq-3">ğŸ§¥</div><div class="eq-item eq-4">ğŸ›°ï¸</div>
            <div class="eq-item eq-5">â›‘ï¸</div><div class="eq-item eq-6">ğŸ¦º</div><div class="eq-item eq-7">ğŸ‘¢</div>
            <div class="eq-item eq-8">ğŸ˜·</div><div class="eq-item eq-9">ğŸ—¡ï¸</div>
        </div>
    </div>
    
    <div id="chick-speech">"æº–å‚™å¥½è¦å»å†’éšªäº†å—ï¼Ÿ Ready to go?"</div>

    <div id="game-box">
        <div class="stage-badge" id="stage-info">MISSION START</div>
        <div class="question" id="question-text">æŒ‘æˆ°å³å°‡é–‹å§‹ï¼Œè«‹ç¢ºä¿éŸ³é‡å·²é–‹å•Ÿã€‚<span class="en-q">Test start! Click options to hear pronunciation.</span></div>
        <div class="options-grid" id="options-container">
            <button onclick="initGame()" style="background: var(--gold); border:none;">Let's Go! ğŸš€</button>
        </div>
    </div>

    <div id="ceremony">
        <div style="font-size: 80px;">ğŸ†</div>
        <h1 style="color: var(--gold); font-size: 2rem; margin: 10px 0;">SURVIVAL HERO</h1>
        <p id="ceremony-text" style="padding: 0 40px; line-height: 1.8; font-size: 16px;"></p>
        <button onclick="location.reload()" style="background: var(--gold); border:none; padding: 12px 40px; border-radius:50px; font-weight:bold; margin-top:20px; cursor:pointer;">å†æ¬¡å•Ÿç¨‹ / Replay</button>
    </div>

    <div id="progress-bar"></div>

    <script>
        // --- 1. 3D æ¸²æŸ“ç³»çµ± ---
        let scene, camera, renderer, chickModel;
        let animationType = 'idle';
        let animationProgress = 0;
        let baseScale = 1; // ç”¨æ–¼å›ºå®šåˆå§‹æ¯”ä¾‹

        function init3D() {
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            const ambLight = new THREE.AmbientLight(0xffffff, 0.9);
            scene.add(ambLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
            dirLight.position.set(5, 10, 7.5);
            scene.add(dirLight);

            const loader = new THREE.GLTFLoader();
            loader.load('plush.glb', (gltf) => {
                chickModel = gltf.scene;
                const box = new THREE.Box3().setFromObject(chickModel);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3()).length();
                chickModel.position.sub(center); 
                // å„²å­˜åˆå§‹æ¯”ä¾‹ï¼Œè§£æ±ºæ™‚å¤§æ™‚å°å•é¡Œ
                baseScale = 2.8 / size; 
                chickModel.scale.setScalar(baseScale);
                scene.add(chickModel);
            });

            camera.position.set(0, 0, 5);
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            if (chickModel) {
                chickModel.rotation.y += 0.01;

                if (animationType === 'happy') {
                    animationProgress += 0.1;
                    chickModel.position.y = Math.abs(Math.sin(animationProgress)) * 1.2;
                    chickModel.rotation.z = Math.sin(animationProgress * 2) * 0.4;
                    // åŸºæ–¼ baseScale åšç¸®æ”¾è®ŠåŒ–
                    chickModel.scale.setScalar(baseScale * (1 + Math.sin(animationProgress) * 0.15));

                    if (animationProgress > Math.PI * 2) resetAnimation();
                } else if (animationType === 'shake') {
                    animationProgress += 0.3;
                    chickModel.position.x = Math.sin(animationProgress * 5) * 0.15;
                    if (animationProgress > 5) resetAnimation();
                }
            }
            renderer.render(scene, camera);
        }

        function resetAnimation() {
            animationType = 'idle';
            animationProgress = 0;
            if (chickModel) {
                chickModel.position.set(0, 0, 0);
                chickModel.rotation.z = 0;
                chickModel.scale.setScalar(baseScale); // å›åˆ°æ­£ç¢ºæ¯”ä¾‹
            }
        }

        function triggerAction(type) {
            animationType = type;
            animationProgress = 0;
        }

        // --- 2. æ¸¬é©—å…§å®¹ (10-10-10) ---
        const easyData = [
            { q: "æ£®æ—æ˜¯ä¸€å€‹è¤‡é›œçš„ã€Œç”Ÿæ…‹ç³»çµ±ã€ã€‚", eq: "The forest is a complex 'Ecosystem'.", a: ["Economy", "Ecosystem", "Biology"], c: 1 },
            { q: "æ¤ç‰©é€éã€Œå…‰åˆä½œç”¨ã€è£½é€ èƒ½é‡ã€‚", eq: "Plants produce energy through 'Photosynthesis'.", a: ["Photosynthesis", "Photography", "Physics"], c: 0 },
            { q: "æˆ‘å€‘è¦ä¿è­·æ£®æ—çš„ã€Œç”Ÿç‰©å¤šæ¨£æ€§ã€ã€‚", eq: "We must protect the forest's 'Biodiversity'.", a: ["Diversity", "Biodiversity", "Society"], c: 1 },
            { q: "é€™è£¡æ˜¯é‡ç”Ÿå‹•ç‰©çš„å¤©ç„¶ã€Œæ£²æ¯åœ°ã€ã€‚", eq: "This is a natural 'Habitat' for wildlife.", a: ["Habit", "Habitat", "Heaven"], c: 1 },
            { q: "ç”Ÿç‰©å¿…é ˆå­¸æœƒã€Œé©æ‡‰ã€ç’°å¢ƒã€‚", eq: "Creatures must learn 'Adaptation' to survive.", a: ["Adaptation", "Adoption", "Attention"], c: 0 },
            { q: "ç…å­æ˜¯è‡ªç„¶ç•Œä¸­çš„ã€Œæ•é£Ÿè€…ã€ã€‚", eq: "Lions are 'Predators' in the wild.", a: ["Predator", "Prey", "Player"], c: 0 },
            { q: "å…”å­å¸¸æˆç‚ºè€é·¹çš„ã€Œçµç‰©ã€ã€‚", eq: "Rabbits are often 'Prey' for eagles.", a: ["Predator", "Prey", "Price"], c: 1 },
            { q: "é•·é ¸é¹¿æ˜¯ã€Œè‰é£Ÿæ€§çš„ã€å‹•ç‰©ã€‚", eq: "Giraffes are 'Herbivorous' animals.", a: ["Carnivorous", "Herbivorous", "Omnivorous"], c: 1 },
            { q: "è€è™æ˜¯å¼·å£¯çš„ã€Œè‚‰é£Ÿæ€§çš„ã€å‹•ç‰©ã€‚", eq: "Tigers are strong 'Carnivorous' animals.", a: ["Carnivorous", "Herbivorous", "Omnivorous"], c: 0 },
            { q: "äººé¡é€šå¸¸æ˜¯ã€Œé›œé£Ÿæ€§çš„ã€ã€‚", eq: "Humans are generally 'Omnivorous'.", a: ["Carnivorous", "Herbivorous", "Omnivorous"], c: 2 }
        ];

        const mediumData = [
            { q: "æ±‚ç”Ÿ 333 åŸå‰‡ï¼šæ²’ç©ºæ°£åƒ…èƒ½æ´» 3 åˆ†é˜ã€‚", eq: "333 Rule: 3 minutes without Air.", a: ["Three Minutes", "Thirty Minutes", "Three Hours"], c: 0, r: "Compass ğŸ§­" },
            { q: "æ±‚ç”Ÿ 333 åŸå‰‡ï¼šå¤±æº«é˜²è­·ä¸è¶³åƒ…èƒ½æ´» 3 å°æ™‚ã€‚", eq: "333 Rule: 3 hours without Shelter.", a: ["Three Minutes", "Three Hours", "Three Days"], c: 1, r: "Cape ğŸ§¥" },
            { q: "æ±‚ç”Ÿ 333 åŸå‰‡ï¼šæ²’é£²æ°´åƒ…èƒ½æ´» 3 å¤©ã€‚", eq: "333 Rule: 3 days without Water.", a: ["Three Hours", "Three Days", "Three Weeks"], c: 1, r: "Water Bottle ğŸ¼" },
            { q: "æ±‚ç”Ÿ 333 åŸå‰‡ï¼šæ²’é£Ÿç‰©åƒ…èƒ½æ´» 3 é€±ã€‚", eq: "333 Rule: 3 weeks without Food.", a: ["Three Days", "Three Weeks", "Three Months"], c: 1, r: "Backpack ğŸ’" },
            { q: "ã€ŒæŒ‡å—é‡ã€åœ¨è¿·è·¯æ™‚å¾ˆæœ‰ç”¨ã€‚", eq: "A 'Compass' is useful when lost.", a: ["Compass", "Mirror", "Hammer"], c: 0, r: "Gear Kit ğŸ“¦" },
            { q: "é€™æ˜¯ä¸€æ”¯ã€Œè¡›æ˜Ÿæ‰‹æ©Ÿã€ã€‚", eq: "This is a 'Satellite Phone'.", a: ["GPS", "Satellite Phone", "LAN"], c: 1, r: "Satellite ğŸ›°ï¸" },
            { q: "ä½ éœ€è¦ã€Œé˜²æ°´çš„ã€å¤–å¥—ã€‚", eq: "You need a 'Waterproof' jacket.", a: ["Waterproof", "Waterslide", "Waterfall"], c: 0, r: "Raincoat ğŸ§¥" },
            { q: "ã€Œé€šè¨Šã€åœ¨æ±‚ç”Ÿä¸­å¾ˆé—œéµã€‚", eq: "Communication is key in survival.", a: ["Communication", "Energy", "Digital"], c: 0, r: "Signal Flag ğŸš©" },
            { q: "ç¾…ç›¤ä¸Šçš„ 'W' ä»£è¡¨ã€Œè¥¿æ–¹ã€ã€‚", eq: "'W' on a compass stands for 'West'.", a: ["East", "West", "North"], c: 1, r: "Map ğŸ—ºï¸" },
            { q: "å¸¶ä¸€äº›ã€Œé«˜èƒ½é‡ã€çš„é›¶é£Ÿã€‚", eq: "Bring some 'High-energy' snacks.", a: ["High-energy", "High-water", "Heavy"], c: 0, r: "Energy Bar ğŸ«" }
        ];

        const hardData = [
            { q: "å¦‚æœä½ é‡åˆ°é»‘ç†Šï¼Œè«‹æ…¢æ…¢å¾Œé€€ã€‚", eq: "If you encounter a bear, back away slowly.", a: ["Run away", "Back away slowly", "Play dead"], c: 1, r: "Helmet â›‘ï¸" },
            { q: "åœ¨åŠ‡çƒˆäº‚æµä¸­ï¼Œè«‹ç©¿ä¸Šæ•‘ç”Ÿè¡£ã€‚", eq: "In severe turbulence, wear a life jacket.", a: ["Wear life jacket", "Jump", "Stand up"], c: 0, r: "Lifevest ğŸ¦º" },
            { q: "åœŸçŸ³æµç™¼ç”Ÿæ™‚ï¼Œå¾€å…©å´é«˜è™•é€ƒã€‚", eq: "When a landslide occurs, move sideways.", a: ["Move sideways", "Run down", "Stay still"], c: 0, r: "Boots ğŸ‘¢" },
            { q: "è‹¥è¢«èœœèœ‚è¿½ï¼Œèº²é€²å°é–‰çš„é®è”½è™•ã€‚", eq: "If chased by bees, run to a shelter.", a: ["Jump in water", "Run to shelter", "Swat"], c: 1, r: "Insect Net ğŸ•¸ï¸" },
            { q: "è¢«è›‡å’¬å‚·å¾Œï¼Œä¿æŒå‚·å£ä½æ–¼å¿ƒè‡Ÿã€‚", eq: "Keep the wound below the heart after a snake bite.", a: ["Suck venom", "Keep below heart", "Run"], c: 1, r: "First Aid ğŸ©¹" },
            { q: "æ‰“é›·æ™‚ï¼Œçµ•å°ä¸è¦èº²åœ¨å¤§æ¨¹ä¸‹ã€‚", eq: "Never hide under a tree during a thunderstorm.", a: ["Low ground", "Under a tree", "Inside car"], c: 1, r: "Insulated Suit âš¡" },
            { q: "å¦‚æœä½ åœ¨æ£®æ—è¿·è·¯ï¼Œç•™åœ¨åŸåœ°å¾…æ´ã€‚", eq: "If lost in the forest, stay where you are.", a: ["Keep walking", "Stay where you are", "Shout"], c: 1, r: "Whistle ğŸ””" },
            { q: "é‡æ£®æ—ç«ç½ï¼Œå¾€é€†é¢¨æ–¹å‘é€ƒç”Ÿã€‚", eq: "Run upwind to escape a forest fire.", a: ["Downwind", "Upwind", "Up hill"], c: 1, r: "Breath Mask ğŸ˜·" },
            { q: "æºªæ°´è®Šæ¿ä»£è¡¨ä¸Šæ¸¸å¯èƒ½æœ‰å±±æ´ªã€‚", eq: "Muddy water means a flash flood is coming.", a: ["Swimming", "Hiking", "Flash flood"], c: 2, r: "Rope ğŸª¢" },
            { q: "æ­å–œï¼é ˜å–ä½ çš„è‹±é›„åŠï¼", eq: "Congrats! Claim your hero sword!", a: ["Claim", "Reject", "Maybe"], c: 0, r: "Sword ğŸ—¡ï¸" }
        ];

        const funnyLines = [
            "å“å‘€ï¼å°é›åš‡åˆ°æ¯›éƒ½ç‚¸é–‹äº†ï¼ / Oops!",
            "é€™å€‹ç­”æ¡ˆæ¯”æ²’æ”¶è¨Šçš„å°è¬›æ©Ÿé‚„æ²’ç”¨ã€‚",
            "å°é›èªªï¼šé€™ä¸æ˜¯å‹‡æ•¢ï¼Œé€™æ˜¯å†’å¤±ï¼",
            "ä½ ç¢ºå®šå—ï¼Ÿå°é›ç·Šå¼µåˆ°æƒ³æŒ–åœ°æ´...",
            "ç³Ÿç³•ï¼é»‘ç†Šæ­£åœ¨æ—é‚Šçµ¦ä½ è² è©•ã€‚"
        ];

        let currentStage = "easy"; 
        let currentIdx = 0;
        let score = 0;
        let solvedCount = 0;
        let eqCount = 0;
        const totalQuestions = 30;

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 1;
            window.speechSynthesis.speak(utterance);
        }

        function initGame() {
            score = 0; currentIdx = 0; solvedCount = 0; eqCount = 0;
            currentStage = "easy";
            document.querySelectorAll('.eq-item').forEach(el => el.classList.remove('active'));
            speak("Let's go!");
            loadQuestion();
        }

        function loadQuestion() {
            let data;
            if(currentStage === "easy") {
                data = easyData[currentIdx];
                document.body.className = "easy";
                document.getElementById('scene-name').innerText = "ğŸŒ² Easy: Vocabulary";
                document.getElementById('stage-info').innerText = `LEVEL 1 - ${currentIdx + 1}/10`;
            } else if(currentStage === "medium") {
                data = mediumData[currentIdx];
                document.body.className = "medium";
                document.getElementById('scene-name').innerText = "ğŸ’ Medium: Gear Check";
                document.getElementById('stage-info').innerText = `LEVEL 2 - ${currentIdx + 1}/10`;
            } else {
                data = hardData[currentIdx];
                document.body.className = "hard";
                document.getElementById('scene-name').innerText = "âš ï¸ Hard: Survival";
                document.getElementById('stage-info').innerText = `LEVEL 3 - ${currentIdx + 1}/10`;
            }

            document.getElementById('question-text').innerHTML = `${data.q}<span class="en-q">${data.eq}</span>`;
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            data.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.innerText = opt;
                btn.onclick = () => {
                    speak(opt);
                    checkAnswer(i, btn);
                };
                container.appendChild(btn);
            });
            document.getElementById('progress-bar').style.width = (solvedCount/totalQuestions * 100) + '%';
        }

        function checkAnswer(idx, btn) {
            let data = (currentStage === "easy") ? easyData[currentIdx] : 
                       (currentStage === "medium") ? mediumData[currentIdx] : hardData[currentIdx];
            
            const buttons = document.querySelectorAll('#options-container button');
            buttons.forEach(b => b.disabled = true);

            if(idx === data.c) {
                btn.classList.add('correct');
                score += (currentStage === "easy" ? 10 : currentStage === "medium" ? 20 : 30);
                document.getElementById('chick-speech').innerText = "Excellent! âœ¨";
                speak("Excellent!");
                triggerAction('happy');
                
                if(currentStage !== "easy" && data.r) {
                    setTimeout(() => {
                        const eqItem = document.querySelector(`.eq-${eqCount}`);
                        if(eqItem) {
                            eqItem.classList.add('active');
                            eqCount++;
                        }
                    }, 500);
                }
            } else {
                btn.classList.add('wrong');
                buttons[data.c].classList.add('correct');
                document.getElementById('chick-speech').innerText = funnyLines[Math.floor(Math.random()*funnyLines.length)];
                speak("Oops!");
                triggerAction('shake');
            }

            document.getElementById('score-val').innerText = score;
            solvedCount++;
            currentIdx++;

            setTimeout(() => {
                if(currentIdx >= 10) {
                    if(currentStage === "easy") {
                        currentStage = "medium"; currentIdx = 0; loadQuestion();
                    } else if(currentStage === "medium") {
                        currentStage = "hard"; currentIdx = 0; loadQuestion();
                    } else {
                        finishGame();
                    }
                } else {
                    loadQuestion();
                }
            }, 3000);
        }

        function finishGame() {
            document.getElementById('progress-bar').style.width = '100%';
            document.getElementById('ceremony').style.display = 'flex';
            document.getElementById('ceremony-text').innerText = `Legendary Survivor!\nFinal Score: ${score} points.`;
            speak("Congratulations!");
        }

        document.addEventListener('DOMContentLoaded', init3D);
    </script>
</body>
</html>
