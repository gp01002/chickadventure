<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é›è‹±æ–‡å†’éšª - 3D é›™èªå¤§å¸«ç‰ˆ</title>
    <!-- å¼•å…¥ Three.js å¼•æ“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --scene-bg: #e8f5e9;
            --scene-accent: #81c784;
            --text-color: #333;
            --gold: #ffd700;
        }

        body.easy { --scene-bg: #e8f5e9; --scene-accent: #2e7d32; }
        body.medium { --scene-bg: #fff3e0; --scene-accent: #e65100; }
        body.hard { --scene-bg: #37474f; --scene-accent: #ff5252; --text-color: #fff; }

        * { box-sizing: border-box; transition: background-color 0.8s ease; }

        body {
            background-color: var(--scene-bg);
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; color: var(--text-color); overflow: hidden; position: relative;
            /* èƒŒæ™¯åœ–å±¤ç´šé è¨­ */
            background-size: cover;
            background-position: center;
            background-blend-mode: overlay;
        }

        /* èƒŒæ™¯åœ–æ¨£å¼åˆ‡æ› (è‹¥å·²ä¸Šå‚³åœ–ç‰‡å¯å–æ¶ˆè¨»è§£) */
        /* body.easy { background-image: url('bg_easy.jpg'); }
        body.medium { background-image: url('bg_medium.jpg'); }
        body.hard { background-image: url('bg_hard.jpg'); }
        */

        #top-info {
            position: fixed; top: 20px; width: 90%; max-width: 500px;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.9); padding: 12px 25px; border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 10; color: #333;
        }

        /* 3D ç•«å¸ƒå®¹å™¨ */
        #canvas-container {
            width: 250px; height: 250px;
            margin-bottom: 10px; z-index: 5;
            cursor: pointer;
        }

        #chick-speech { 
            margin-top: 10px; padding: 12px 20px; 
            background: white; border-radius: 15px; 
            font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            position: relative; color: #333; max-width: 320px; 
            text-align: center; font-size: 15px;
        }

        #game-box {
            background: white; padding: 25px; border-radius: 28px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            text-align: center; width: 95%; max-width: 500px; 
            z-index: 5; color: #333; margin-top: 10px;
        }

        .stage-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; background: #eee; font-size: 12px; margin-bottom: 8px; font-weight: 800; color: var(--scene-accent); }
        .question { font-size: 17px; margin-bottom: 15px; line-height: 1.5; font-weight: 600; text-align: left; }
        .en-q { color: #666; font-style: italic; font-size: 14px; display: block; margin-top: 5px; border-left: 3px solid var(--scene-accent); padding-left: 10px; }

        .options-grid { display: grid; grid-template-columns: 1fr; gap: 8px; }

        button {
            padding: 14px 20px; border: 2px solid #eee; background: #fff; border-radius: 12px;
            cursor: pointer; font-size: 18px; font-weight: bold; color: #444; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        button:hover:not(:disabled) { border-color: var(--scene-accent); transform: scale(1.02); }
        button.correct { background: #81c784 !important; color: white; border-color: #81c784; }
        button.wrong { background: #e57373 !important; color: white; border-color: #e57373; }

        #ceremony {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            color: white; z-index: 100; text-align: center;
        }
        #progress-bar { position: fixed; bottom: 0; left: 0; height: 10px; background: var(--scene-accent); width: 0%; transition: width 0.5s; }
    </style>
</head>
<body class="easy">

    <div id="top-info">
        <span id="scene-name">ğŸŒ² å®¹æ˜“éšæ®µï¼šå–®å­—èªè®€</span>
        <span>å¾—åˆ†: <strong id="score-val">0</strong></span>
    </div>

    <!-- 3D å°é›æ¸²æŸ“ä½ç½® -->
    <div id="canvas-container"></div>
    
    <div id="chick-speech">"é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹ï¼<br>Click to start!"</div>

    <div id="game-box">
        <div class="stage-badge" id="stage-info">MISSION START</div>
        <div class="question" id="question-text">æº–å‚™å¥½åƒåŠ  30 é¡Œé›™èªç”Ÿå­˜æ¸¬é©—äº†å—ï¼Ÿ<span class="en-q">Ready for the 30-question bilingual test?</span></div>
        <div class="options-grid" id="options-container">
            <button onclick="initGame()" style="background: var(--gold); border:none;">Let's Go! ğŸš€</button>
        </div>
    </div>

    <div id="ceremony">
        <div style="font-size: 80px;">ğŸ†</div>
        <h1 style="color: var(--gold); font-size: 2rem;">LEGENDARY HERO</h1>
        <p id="ceremony-text" style="padding: 0 40px; line-height: 1.6;"></p>
        <button onclick="location.reload()" style="background: var(--gold); border:none; padding: 15px 40px; border-radius:50px; font-weight:bold; margin-top:20px; cursor:pointer;">Play Again / å†æ¬¡æŒ‘æˆ°</button>
    </div>

    <div id="progress-bar"></div>

    <script>
        // --- 1. Three.js 3D å°é›å»ºæ§‹ ---
        let scene, camera, renderer, chickGroup;
        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(50, 1, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(250, 250);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // å…‰æº
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 5, 5).normalize();
            scene.add(light);
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));

            // å°é›èº«é«”
            chickGroup = new THREE.Group();
            const bodyGeo = new THREE.SphereGeometry(1, 32, 32);
            const bodyMat = new THREE.MeshToonMaterial({ color: 0xffec85 });
            const body = new THREE.Mesh(bodyGeo, bodyMat);
            body.scale.set(1, 1.1, 1);
            chickGroup.add(body);

            // çœ¼ç›
            const eyeGeo = new THREE.SphereGeometry(0.1, 16, 16);
            const eyeMat = new THREE.MeshBasicMaterial({ color: 0x333333 });
            const eyeL = new THREE.Mesh(eyeGeo, eyeMat);
            eyeL.position.set(0.35, 0.3, 0.85);
            const eyeR = new THREE.Mesh(eyeGeo, eyeMat);
            eyeR.position.set(-0.35, 0.3, 0.85);
            chickGroup.add(eyeL, eyeR);

            // å˜´å·´ (åœ“éŒé«”)
            const beakGeo = new THREE.ConeGeometry(0.2, 0.4, 16);
            const beakMat = new THREE.MeshToonMaterial({ color: 0xff9d42 });
            const beak = new THREE.Mesh(beakGeo, beakMat);
            beak.position.set(0, 0, 1);
            beak.rotation.x = Math.PI / 2;
            chickGroup.add(beak);

            scene.add(chickGroup);
            camera.position.z = 4;
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            if (chickGroup) {
                chickGroup.rotation.y += 0.01;
            }
            renderer.render(scene, camera);
        }

        // 3D å°é›å‹•æ…‹åæ‡‰
        function chickAction(type) {
            if (type === 'happy') {
                chickGroup.position.y = 0;
                let jumpCount = 0;
                const jump = setInterval(() => {
                    chickGroup.position.y = Math.abs(Math.sin(jumpCount)) * 0.8;
                    chickGroup.rotation.z = Math.sin(jumpCount) * 0.2;
                    jumpCount += 0.2;
                    if (jumpCount > Math.PI * 2) {
                        clearInterval(jump);
                        chickGroup.position.y = 0;
                        chickGroup.rotation.z = 0;
                    }
                }, 20);
            } else {
                let shakeCount = 0;
                const shake = setInterval(() => {
                    chickGroup.position.x = Math.sin(shakeCount * 5) * 0.1;
                    shakeCount += 0.2;
                    if (shakeCount > 4) {
                        clearInterval(shake);
                        chickGroup.position.x = 0;
                    }
                }, 20);
            }
        }

        // --- 2. é¡Œåº«èˆ‡éŠæˆ²é‚è¼¯ ---
        const easyData = [
            { q: "æ£®æ—æ˜¯ä¸€å€‹è¤‡é›œçš„ã€Œç”Ÿæ…‹ç³»çµ±ã€ã€‚", eq: "The forest is a complex 'Ecosystem'.", a: ["Economy", "Ecosystem", "Biology"], c: 1 },
            { q: "æ¤ç‰©é€éã€Œå…‰åˆä½œç”¨ã€è£½é€ èƒ½é‡ã€‚", eq: "Plants produce energy through 'Photosynthesis'.", a: ["Photosynthesis", "Photography", "Physics"], c: 0 },
            { q: "æˆ‘å€‘è¦ä¿è­·æ£®æ—çš„ã€Œç”Ÿç‰©å¤šæ¨£æ€§ã€ã€‚", eq: "We must protect the forest's 'Biodiversity'.", a: ["Diversity", "Biodiversity", "Society"], c: 1 },
            { q: "é€™è£¡æ˜¯é‡ç”Ÿå‹•ç‰©çš„å¤©ç„¶ã€Œæ£²æ¯åœ°ã€ã€‚", eq: "This is a natural 'Habitat' for wildlife.", a: ["Habit", "Habitat", "Heaven"], c: 1 },
            { q: "ç”Ÿç‰©å¿…é ˆå­¸æœƒã€Œé©æ‡‰ã€ç’°å¢ƒã€‚", eq: "Creatures must learn 'Adaptation' to survive.", a: ["Adaptation", "Adoption", "Attention"], c: 0 },
            { q: "ç…å­æ˜¯è‡ªç„¶ç•Œä¸­çš„ã€Œæ•é£Ÿè€…ã€ã€‚", eq: "Lions are 'Predators' in the wild.", a: ["Predator", "Prey", "Player"], c: 0 },
            { q: "å…”å­å¸¸æˆç‚ºè€é·¹çš„ã€Œçµç‰©ã€ã€‚", eq: "Rabbits are often 'Prey' for eagles.", a: ["Predator", "Prey", "Price"], c: 1 },
            { q: "é•·é ¸é¹¿æ˜¯ã€Œè‰é£Ÿæ€§çš„ã€å‹•ç‰©ã€‚", eq: "Giraffes are 'Herbivorous' animals.", a: ["Carnivorous", "Herbivorous", "Omnivorous"], c: 1 },
            { q: "è€è™æ˜¯å¼·å£¯çš„ã€Œè‚‰é£Ÿæ€§çš„ã€å‹•ç‰©ã€‚", eq: "Tigers are strong 'Carnivorous' animals.", a: ["Carnivorous", "Herbivorous", "Omnivorous"], c: 0 },
            { q: "äººé¡é€šå¸¸æ˜¯ã€Œé›œé£Ÿæ€§çš„ã€ã€‚", eq: "Humans are generally 'Omnivorous'.", a: ["Carnivorous", "Herbivorous", "Omnivorous"], c: 2 }
        ];

        const mediumData = [
            { q: "æ±‚ç”Ÿ 333 åŸå‰‡ï¼šæ²’ç©ºæ°£åƒ…èƒ½æ´» 3 åˆ†é˜ã€‚", eq: "333 Rule: 3 minutes without Air.", a: ["Three Minutes", "Thirty Minutes", "Three Hours"], c: 0, r: "ç¾…ç›¤ ğŸ§­" },
            { q: "æ±‚ç”Ÿ 333 åŸå‰‡ï¼šå¤±æº«é˜²è­·ä¸è¶³åƒ…èƒ½æ´» 3 å°æ™‚ã€‚", eq: "333 Rule: 3 hours without Shelter.", a: ["Three Minutes", "Three Hours", "Three Days"], c: 1, r: "ä¿æš–æ–—ç¯· ğŸ§¥" },
            { q: "æ±‚ç”Ÿ 333 åŸå‰‡ï¼šæ²’é£²æ°´åƒ…èƒ½æ´» 3 å¤©ã€‚", eq: "333 Rule: 3 days without Water.", a: ["Three Hours", "Three Days", "Three Weeks"], c: 1, r: "å†’éšªæ°´å£º ğŸ¼" },
            { q: "æ±‚ç”Ÿ 333 åŸå‰‡ï¼šæ²’é£Ÿç‰©åƒ…èƒ½æ´» 3 é€±ã€‚", eq: "333 Rule: 3 weeks without Food.", a: ["Three Days", "Three Weeks", "Three Months"], c: 1, r: "è¡Œå‹•ç³§ ğŸ’" },
            { q: "ã€ŒæŒ‡å—é‡ã€åœ¨è¿·è·¯æ™‚å¾ˆæœ‰ç”¨ã€‚", eq: "A 'Compass' is useful when lost.", a: ["Compass", "Mirror", "Hammer"], c: 0, r: "è£å‚™ç®± ğŸ“¦" },
            { q: "é€™æ˜¯ä¸€æ”¯ã€Œè¡›æ˜Ÿæ‰‹æ©Ÿã€ã€‚", eq: "This is a 'Satellite Phone'.", a: ["GPS", "Satellite Phone", "LAN"], c: 1, r: "é€šè¨Šå™¨ ğŸ›°ï¸" },
            { q: "ä½ éœ€è¦ã€Œé˜²æ°´çš„ã€å¤–å¥—ã€‚", eq: "You need a 'Waterproof' jacket.", a: ["Waterproof", "Waterslide", "Waterfall"], c: 0, r: "é›¨è¡£ ğŸ§¥" },
            { q: "ã€Œé€šè¨Šã€åœ¨æ±‚ç”Ÿä¸­å¾ˆé—œéµã€‚", eq: "Communication is key in survival.", a: ["Communication", "Energy", "Digital"], c: 0, r: "ä¿¡è™Ÿå½ˆ ğŸš©" },
            { q: "ç¾…ç›¤ä¸Šçš„ 'W' ä»£è¡¨ã€Œè¥¿æ–¹ã€ã€‚", eq: "'W' on a compass stands for 'West'.", a: ["East", "West", "North"], c: 1, r: "åœ°åœ– ğŸ—ºï¸" },
            { q: "å¸¶ä¸€äº›ã€Œé«˜èƒ½é‡ã€çš„é›¶é£Ÿã€‚", eq: "Bring some 'High-energy' snacks.", a: ["High-energy", "High-water", "Heavy"], c: 0, r: "èƒ½é‡æ£’ ğŸ«" }
        ];

        const hardData = [
            { q: "å¦‚æœä½ é‡åˆ°é»‘ç†Šï¼Œè«‹æ…¢æ…¢å¾Œé€€ã€‚", eq: "If you encounter a bear, back away slowly.", a: ["Run away", "Back away slowly", "Play dead"], c: 1, r: "é˜²è­·é ­ç›” â›‘ï¸" },
            { q: "åœ¨åŠ‡çƒˆäº‚æµä¸­ï¼Œè«‹ç©¿ä¸Šæ•‘ç”Ÿè¡£ã€‚", eq: "In severe turbulence, wear a life jacket.", a: ["Wear life jacket", "Jump", "Stand up"], c: 0, r: "æ•‘ç”Ÿè¡£ ğŸ¦º" },
            { q: "åœŸçŸ³æµç™¼ç”Ÿæ™‚ï¼Œå¾€å…©å´é«˜è™•é€ƒã€‚", eq: "When a landslide occurs, move sideways.", a: ["Move sideways", "Run down", "Stay still"], c: 0, r: "ç™»å±±é´ ğŸ‘¢" },
            { q: "è‹¥è¢«èœœèœ‚è¿½ï¼Œèº²é€²å°é–‰çš„é®è”½è™•ã€‚", eq: "If chased by bees, run to a shelter.", a: ["Jump in water", "Run to shelter", "Swat"], c: 1, r: "é˜²èŸ²ç¶² ğŸ•¸ï¸" },
            { q: "è¢«è›‡å’¬å‚·å¾Œï¼Œä¿æŒå‚·å£ä½æ–¼å¿ƒè‡Ÿã€‚", eq: "Keep the wound below the heart after a snake bite.", a: ["Suck venom", "Keep below heart", "Run"], c: 1, r: "æ€¥æ•‘åŒ… ğŸ©¹" },
            { q: "æ‰“é›·æ™‚ï¼Œçµ•å°ä¸è¦èº²åœ¨å¤§æ¨¹ä¸‹ã€‚", eq: "Never hide under a tree during a thunderstorm.", a: ["Low ground", "Under a tree", "Inside car"], c: 1, r: "çµ•ç·£è¡£ âš¡" },
            { q: "å¦‚æœä½ åœ¨æ£®æ—è¿·è·¯ï¼Œç•™åœ¨åŸåœ°å¾…æ´ã€‚", eq: "If lost in the forest, stay where you are.", a: ["Keep walking", "Stay where you are", "Shout"], c: 1, r: "å“¨å­  whistle" },
            { q: "é‡æ£®æ—ç«ç½ï¼Œå¾€é€†é¢¨æ–¹å‘é€ƒç”Ÿã€‚", eq: "Run upwind to escape a forest fire.", a: ["Downwind", "Upwind", "Up hill"], c: 1, r: "å‘¼å¸ç½© ğŸ˜·" },
            { q: "æºªæ°´è®Šæ¿ä»£è¡¨ä¸Šæ¸¸å¯èƒ½æœ‰å±±æ´ªã€‚", eq: "Muddy water means a flash flood is coming.", a: ["Swimming", "Hiking", "Flash flood"], c: 2, r: "æ•‘ç”Ÿç´¢ ğŸª¢" },
            { q: "æ­å–œï¼é ˜å–ä½ çš„è‹±é›„åŠï¼", eq: "Congrats! Claim your hero sword!", a: ["Claim", "Reject", "Maybe"], c: 0, r: "è‹±é›„åŠ ğŸ—¡ï¸" }
        ];

        const funnyLines = [
            "å“å‘€ï¼é€™é¸æ“‡è®“å°é›åš‡åˆ°æ—‹è½‰ï¼ / Oops! Chick is spinning in shock!",
            "é€™ç­”æ¡ˆæ¯”æ²’è¨Šè™Ÿçš„æ‰‹æ©Ÿé‚„æ²’ç”¨ã€‚ / More useless than a phone with no signal.",
            "å°é›èªªï¼šé€™ä¸æ˜¯å†’éšªï¼Œé€™æ˜¯å†’å¤±ï¼ / Chick says: That's reckless!",
            "ä½ ç¢ºå®šå—ï¼Ÿå°é›é–‹å§‹ç™¼æŠ–äº†... / Are you sure? Chick is shaking...",
            "ç³Ÿç³•ï¼é»‘ç†Šæ­£åœ¨æ—é‚Šçµ¦ä½ è² è©•ã€‚ / Oh no! The bear is giving you a thumbs down."
        ];

        let currentStage = "easy"; 
        let currentIdx = 0;
        let score = 0;
        let solvedCount = 0;
        let eqCount = 0;
        const totalQuestions = 30;

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 1;
            window.speechSynthesis.speak(utterance);
        }

        function initGame() {
            score = 0; currentIdx = 0; solvedCount = 0; eqCount = 0;
            currentStage = "easy";
            speak("Let's go! Survival adventure begins!");
            loadQuestion();
        }

        function loadQuestion() {
            let data;
            if(currentStage === "easy") {
                data = easyData[currentIdx];
                document.body.className = "easy";
                document.getElementById('scene-name').innerText = "ğŸŒ² Easy: Vocabulary";
                document.getElementById('stage-info').innerText = `LEVEL 1 - ${currentIdx + 1}/10`;
            } else if(currentStage === "medium") {
                data = mediumData[currentIdx];
                document.body.className = "medium";
                document.getElementById('scene-name').innerText = "ğŸ’ Medium: Gear Check";
                document.getElementById('stage-info').innerText = `LEVEL 2 - ${currentIdx + 1}/10`;
            } else {
                data = hardData[currentIdx];
                document.body.className = "hard";
                document.getElementById('scene-name').innerText = "âš ï¸ Hard: Survival";
                document.getElementById('stage-info').innerText = `LEVEL 3 - ${currentIdx + 1}/10`;
            }

            document.getElementById('question-text').innerHTML = `${data.q}<span class="en-q">${data.eq}</span>`;
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            data.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.innerText = opt;
                btn.onclick = () => {
                    speak(opt);
                    checkAnswer(i, btn);
                };
                container.appendChild(btn);
            });
            document.getElementById('progress-bar').style.width = (solvedCount/totalQuestions * 100) + '%';
        }

        function checkAnswer(idx, btn) {
            let data = (currentStage === "easy") ? easyData[currentIdx] : 
                       (currentStage === "medium") ? mediumData[currentIdx] : hardData[currentIdx];
            
            const buttons = document.querySelectorAll('#options-container button');
            buttons.forEach(b => b.disabled = true);

            if(idx === data.c) {
                btn.classList.add('correct');
                score += (currentStage === "easy" ? 10 : currentStage === "medium" ? 20 : 30);
                document.getElementById('chick-speech').innerText = "Excellent! Perfect move!";
                speak("Excellent!");
                chickAction('happy');
                
                if(data.r) {
                    setTimeout(() => {
                        const eqItem = document.querySelector(`.eq-${eqCount}`);
                        if(eqItem) {
                            eqItem.innerText = data.r.split(' ')[0];
                            eqItem.classList.add('active');
                            eqCount++;
                        }
                        document.getElementById('chick-speech').innerText = `Item Unlocked: ${data.r}`;
                    }, 500);
                }
            } else {
                btn.classList.add('wrong');
                buttons[data.c].classList.add('correct');
                document.getElementById('chick-speech').innerText = funnyLines[Math.floor(Math.random()*funnyLines.length)];
                speak("Oops! Wrong way!");
                chickAction('shake');
            }

            document.getElementById('score-val').innerText = score;
            solvedCount++;
            currentIdx++;

            setTimeout(() => {
                if(currentIdx >= 10) {
                    if(currentStage === "easy") {
                        speak("Stage clear! Entering Medium Stage!");
                        currentStage = "medium"; currentIdx = 0; loadQuestion();
                    } else if(currentStage === "medium") {
                        speak("Gear check complete! Entering Danger Zone!");
                        currentStage = "hard"; currentIdx = 0; loadQuestion();
                    } else {
                        finishGame();
                    }
                } else {
                    loadQuestion();
                }
            }, 3000);
        }

        function finishGame() {
            document.getElementById('progress-bar').style.width = '100%';
            document.getElementById('ceremony').style.display = 'flex';
            document.getElementById('ceremony-text').innerText = `Survival Legend Born!\nScore: ${score} points.\nYou are ready for the wild!`;
            speak("Congratulations! You are a survival hero!");
        }

        window.onload = init3D;
    </script>
</body>
</html>
